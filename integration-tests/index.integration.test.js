// TODO: write integration tests to test the whole flow from end to end